<!DOCTYPE html>
<html>
<head>
  <title>Virtual DOM test page</title>
  <style>
    .item {
      background-color: red;
      width: 300px;
      padding: 10px;
      border: solid 1px black;
    }

    .removed {
      opacity: 0.5;
    }

    .added {
      background-color: darkRed;
    }
  </style>
  <script src="domsetter.js"></script>
  <script src="showStats.js"></script>
  <script>
    var h = window.domsetter.h;

    var simplisticDiff = {
      nodeToRemove: function (node) {
        node.classList.add("removed");
        setTimeout(function () {
          node.parentNode.removeChild(node);
        }, 500);
      },
      nodeAdded: function (node) {
        node.classList.add("added");
        setTimeout(function () {
          node.classList.remove("added");
        }, 500);
      },
      nodeUpdated: function (node) {
        node.classList.add("updated");
        setTimeout(function () {
          node.classList.remove("updated");
        }, 500);
      }
    };

    document.addEventListener('DOMContentLoaded', function () {
      var items = [];
      for (var i = 0; i < 20; i++) {
        items.push({ title: "Item " + i, visible: i % 2 === 0, id: i });
      }
      var render = function () {
        return h("div", {}, items.filter(function (item) { return item.visible; }).map(function (item) {
          return h("div.item", { key: "item-" + item.id }, [item.title]);
        }));
      };

      var mount = window.domsetter.createDom(render());
      document.body.appendChild(mount.domNode);

      setTimeout(function () {
        items[16].visible = false;
        mount.update(render(), simplisticDiff);
        setTimeout(function () {
          items[1].visible = true;
          items[16].visible = true;
          mount.update(render(), simplisticDiff);
        }, 700);
      }, 300);
    });
  </script>
</head>
<body>

</body>
</html>